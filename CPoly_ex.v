From Stdlib Require Import Psatz.
From mathcomp Require Import all_boot.
Require Import CPoly_I.
From Bignums Require Import BigZ.
From Stdlib Require Import Lra SplitAbsolu.
Import Rtrigo_def Rdefinitions Rpower Rpow_def R_sqrt Ratan Rbasic_fun.

Notation "x ^ y" := (pow x y) : R_scope.

Coercion fromZ := SFBI2.fromZ.

Module V := CPoly_interval SFBI2.

Export V.

Open Scope fexpr_scope.

Declare Scope sollya.

Notation " x * 2^ y " := 
  (Specific_ops.Float x%bigZ y%bigZ) (at level 0) : sollya.
Notation " [ x ; y ] " :=  (Float.Ibnd x y) : sollya.
Notation "[| x1 , x2 , .. , xn |]" := (x1 :: x2 :: .. [:: xn] ..) : sollya.

Open Scope sollya.

(*
Section Example0.

Let prec := 2000%bigZ.


Definition ex0 := (
c(3063571181075177125793339971145979776539228763547242603757554208817905909273197802784821103999745936450584485541522966679437736750889545411821203457319588366190315914269697937138069640086379940512496547012542711135090671493504682299127765555495270625672371531538557350925622839298605132148057705964471315239358428354878178993668376192231442962142150330502873369979131362782624129318243900911066264311379768496088342699231095248430369542811475586079780776758304182818666048003147580741881620641340511486019671689008948542139531264%Z)/c(13365%Z)*'x^12 + c(13286361622689332382571014477248822976605980394569494515024326318992118256741192283104587471179082454696999925943466342884884434774752925546916009952936769242427094909768125567163897311463640187067049668872580681679205022077520288658292148866205120287690891244393237735657511358729685397866484985448267125697842541652431558464123555853194767370533711292393386884424546880980439206632501956537635802236419257846687344595478327257658201905509498838004254456554507630898315685498193204062423465668606540585064721952688795897209295450425786368%Z)/c(155925%Z)*'x^11*exp(x) - c(3624387954200263068737950687761157443974581795283596855606908403594442654849087542458964162490137632568565922656490278247093066855248266119655288357686026505232231156280006564453494303535485647857259521926939849742771907617676301206799042933584603362218638650446585468222758202588727376574329986327383893564769821047862271592261153180344194049382024198309830509001234084233343472212105498845744668940243829002119465884429897948502433005731018974794492785407512867122946843645828323560147053101685710269516701722633725601295924869690556416%Z)/c(21%Z)*'x^10*exp(x)^2 - c(4310013910507990689817717442981171549783641966065475900389747282837981680226498694536875145013052949879926065537027407959482157010276211448160819667427841765706483572523783656046007412234019598058230360213680214397557867537321013169571401553683542979952123157463190502660274812938971279202685448491914959790552444655384356775199860319553094867200127572251851437567820582939201114537362019060291139863629819870373237056182526417575416047032479149868209031281838264576704179842381113272413945335211045252333230193232455069175430279487029248%Z)/c(135%Z)*'x^9*exp(x)^3 + c(342597425973821493479830670881372971356706891998151311232243686524588184895556601733583342563081479019502114145755204432021075391327420436063061779840649541145638579212983113076828652815651541678563494013074225812035241413086410263751238293495159042002192812039763451700200779053446890816650718716855790167309779682089848759750729542799117455390283437040648586579864477539455630150819148605309357907891977091640528830987871365195115917244024198933718874929961225265775514218241975817811172096464376815040679392278022813680887231802245120%Z)/c(189%Z)*'x^8*exp(x)^4 - c(14722846461504600002007391908215458835302811965353095339279984757561029819280928698914617259767704286912349664600063805099458601908703665021042619495765637653551479473871303343117457982073136122567455693409647810213324732212712678601667760409293789694781073450998348435541870613031748745275457608523976703187740330449412346404517278964965139612820412003362842773496428237486743497764146487634075866154353679766785401518873203109937920640994019681119122756060758232451830110846998655966358670349920228495279099232429813991028407331192832%Z)/c(4725%Z)*'x^7*exp(x)^5 - c(521149847346933459538571778784672662506885448217226027296618385771696100369979842182599234218281509497615722510329683372880780798214788906599385004290620140342756109019826601150254905936296611314599612259481554338673229456481239468522210196544185335702689196444056232859676489767238485129782346180457437351440924760984238411600479279070375086119463402624297927858134582495505825077025327110478070874046627355298553055960502027437196457278364080070525753445117044837169781771275651184585458949422415699791920463984407621639820279808%Z)/c(675%Z)*'x^6*exp(x)^6 - c(108814270429298557179371672266824287472983122048641921629476296103639841409320444761353346493440680554071195114089128938630867097611811395177249512719908657337052215546449674211835173508660854314800264119269202841168885458344500688978309255897710384554505086087017657874583220614993327471010588908325489556939437600022409525295525597419354937680398021649975729028941458915233961995078599080957327055452502962762918807499832980935975099308536278463941714595413824651337757649969435089201020730683792513300180394723555437635960832%Z)/c(1575%Z)*'x^5*exp(x)^7 + c(11309677173742951263099294936571824905512945739800157557982489674176169382263033497748462393455068998844875019731514397027279142848938049310920724565798872874167328153564467558435840356509184721419778459885804402247816291291185478029622641777811871945698519902544835268437111148314737765940025248972634303051473455258906141276305754824830949044800761691216848766444186515129417599740886256373966127456772717667304840119390519326665690095205620096736476603125755085072326799571272486059699554175155403165798686655495798784%Z)/c(45%Z)*'x^4*exp(x)^8 + c(394372171376887846864168724854095244818352932854180759009932902647632225760571517201825488537954299954301077250450022045675289338143388799315426515655992863065821481180823870122546333313219287802264199373142549973191608633396293029759562384241086729218463417072348941866802494699203442903988725067931937006196646945904764065793824987259712105015749258543769141985082281402957702687984237397308537566875909142044006449262913543651736954572798476825327615153804907719096153244269401010945116392288320999078603880660992%Z)/c(2835%Z)*'x^3*exp(x)^9 - c(8929543707864208513961962575069646624680601887207498850785341547907557334178654301137191161991500400082921042958001718324752530232567292589949254287440742319937279761160093603939708047010494243802883916972475619605313815788296313991430879486746492663198189980485971026689543917195221188790540683571427667946879463538049524655783910921860661725212791317026911471900595999422318283350820282886181991546235613337620074912905625154482481714527589116690967040037473772683907528360542116513863336753387422735138816%Z)/c(675%Z)*'x^2*exp(x)^10 + c(11928566382176211858448435806248993287113635185652839263554975517704673945447939750694629595831389736405828061116039548596790493213374778861033716875223308767073574081832639187730850969266824789353167358340933627154830430143728658679929330253218637911295344675450846530260098726447127657982794800280554076865105516914606528459098943486563512855678210254982965191557527391399051233850133813408478518931803366317554696608276080595347238234772020187313749751585452344076936027266097441629431008976389013504%Z)/c(3465%Z)*'x*exp(x)^11 - c(213039708397481377360325104307229713724946585364636250829661597798630268743244424084749142393840570135314522093516680624008926369160202474193243053562852388368356510785013614800278150755924404630635106121271792152960716966865363991111922339780339775735534147130419155243363823367810498079428070625022670539805869764423369765142973484963960673631523181816374763324307189459107466019682287453663742742371631223179887952508884333536630616387569134517131001198084669416090479195657010205263191024336896%Z)/c(155925%Z)*exp(x)^12 + c(1227796560037130114987092785407782944323156668632432299981616552918114966257596866850185524147520725137061544646190008140349820149704762842466351828074803383918237208366785259009425459322912593237491258053794252546043424617570553584892683690268976422855307706617090173526242489483779560457208718234830367879045937034863445370522500964541272681773233142698227870437913214756486742349827575255120708497152927557010670932097833741768609755722077665482144586596529722458004351665115021771610768920778041059321245659968226583311382740992%Z)/c(17325%Z)*'x^11 + c(24717538640790153606254834248594381179643222916615710277128455335164534220809604392273191703149054086947661436589775314412498428481885171472970855653439108647950705784565718022949458015482565048931017238247913745168136845854992204262970206116334633943175603088361814751490996050695426937056043197906095806990746061903832549203486122982000424937199836403925335704237534994348174876985201227009620833127875059444012954997095857025624665700230854139695439762199935488200524336753947736611619258930557018973629474033671515434661140258617294848%Z)/c(2835%Z)*'x^10*exp(x) + c(2101034342352053679603114281682897278812126828934177742882089377503943635524352350361696143065025219853116194464051629352181021491400758143919656554340051090661312581611325798567036149467075785008683220344739093279305444684034178224811574795803160651150871615559015695672244349109568600700780914979741476740782301990729217500273548952414295737475866597356801736052286539266462243070340554193474914545580778332496801860946848879611405621463297640718684042914332225770050397989302752124360778789427290915627151887581840340321866580926398464%Z)/c(35%Z)*'x^9*exp(x)^2 + c(1254808789443812783171201905798927949572630284904477087535701319407511235960490307024773167537480393516968116315362431449549507475862278527813824364347237027837837575114576405088320747728669390847950859524733965135982197239257868769438052595401562738375073786939508390956493036138369000225596164468274022055891492176917101576598282686272023368370392455487716137975748265253062826410799484894647998117088188566099213181292587926735073053615649110364178336815210676066958493821469929121465895019342826701389663391150180195660378092194379071488%Z)/c(315%Z)*'x^8*exp(x)^3 - c(83157262340411537093945860558509072720097670737420276515749472822647168369494070593672269660650523463510555688595762704596333832019318594312732967409329697898848753268340575852672270864624777023292578756063436553566033289107619781374884816853789625750297210140296294080055575252275410603078441690654584270250532303391468609659452514572231825257674646463241388083176533251522902564978117392587926686649287126249813526630210360664114480388029953078814932813923615649986635437435581242115513719723740689129200040009359738314188550704822484992%Z)/c(945%Z)*'x^7*exp(x)^4 + c(4333724953108491796668882267387717964775570324124493768601232873244576701133791393665370900840644518589491073148761151675693463785206419204695585612152744409421959954496329658950887875077899120484714553835978670221041169480420695167019292860711549096371223902363098000735032029005009804014407718401410539554374107366407684408992756594377154704097326821249906285353513764501786678184870800999757331913482777236070914518250144059168300931052887634097204209733583473164774862970202159052716504270798838885789217878434302368044015520055296%Z)/c(25%Z)*'x^6*exp(x)^5 + c(2928509656880320697713001395039240585871445786608702344824735738562271843698694770010357211709267979031376468851922575506526156727361345280458699856664955421376838354289786272848840423007973170135043091960960057448103973727112995396175834388829509277908253675153599702990005214272846424608815043343283480008913301643039547518539030409102161046863615744160238138619158235737885171158164055029818349686326840464325375689384827316495085050984029504729632835900685772185371093740869053106661756755601302450337373097334469728516182114304%Z)/c(75%Z)*'x^5*exp(x)^6 + c(4527697384441483491557321793433257276141253203383578686304394041970573607946297596473311009637677471108944654625855198691991299125614480764807499048836918235743477688661090787666111740508392964910835577033937475461375123083656068909525392075642491282743224389300964175885428989138656785302055754989464798369276106437582754159757268790286925120716533339930103702388382176568847254403215724329264965524375200518896969981517531082153060511661278147630289301121731873291314786864311164283557771508838035557143027787483538350850179072%Z)/c(945%Z)*'x^4*exp(x)^7 - c(5037701849734386036879602075470674823280514318475676743170124176414965749837102847496532552195162858848723878529409578505137884796276320905362657951940990463570164323979641497022349842841295953096660216548605858996088745321127073318259291524420807607418093568858495512610974853638672353012228625256640609107769871486200653567160791295689437724572508910752259542336439743386973022656630318612020255970523847582231823452844376744538325676391319463225002818624361047199373744636222897438014836412022852831861920384525971488768%Z)/c(315%Z)*'x^3*exp(x)^8 - c(2923161821013890911665061986872764494421040411961629740804257816615508209783068650477950060186301805112248590317219656580451848566252268790348269408132396251596471851578447389647361993749759934149044116624070503679421309187284786805673316094432713348515053131535744639878599626779097796124296230078474661463202998352082914895846623047178531634375981864759692794904893311227937599338853309391971273574178894586974100046144029469187050831763184146885209925932927258935114198541540728782795210009543496427200291115368448%Z)/c(405%Z)*'x^2*exp(x)^9 + c(7308501301902348163417677453382829420406729900358796957767829780544553080417889628022771418554796916070744667268686644071976929503843335291852592973420860677502281461905570892749978418040099760572329323658628286100721818464085169094638601296277780333722928074729371350172774025264884167965684062515491849331937242516965049210874895527434258427860952425231116311804431996256293880616049633303684337163632551228496076493741907609626892174814697578842218778382535404687333398280164970753981214817003930753316159488%Z)/c(14175%Z)*'x*exp(x)^10 - c(326946364925616169055384923471826405982187791325672737806054735052877380574483587535468341025342227523933300099649767733124691083965667792912052611275505563651592247778108612449129275503030645057545154098221055315408857391623496074195417711334443407435299217552419846856555981106207526348543252588636136680717948024009052706663839235633607259008577799667984024676310661754933388758192812742168472688310115132507168321122792899939128167804346476462631111297247875384418005686332021212322106316892493840384%Z)/c(6237%Z)*exp(x)^11 + c(437967793806742455746050992082333980581133786371974332258645920237377025965140998529958855120046686574785960595850338747057113863899178988443937962143180408684239932015196200437598106332187643635817873896155374546692536204428621172358618927372915174731754147436606138784141833102654966055155729639238614484027507567650064765225703967155564090061658349147740498904456579230729602865780588930690990078371278709250294863271908058557380433768745356015061809859260843155586407102503017927633380864462319648799257162195227980067382342189056%Z)/c(42525%Z)*'x^10 + c(1524045327645408473772665085065280089320723795726087728671951185625182624717430437219547103958638527873002330325622273530282110721443299293718792525281888735714681739906294166591593010614546708129949114464771830468671267307225140795680581350193899404485394133793992756214342602220477842044638601979052066491073121769336931870619132598176024481748125687863530231895085532741151364533555038083954296269138976862682694345512359965457544942364325542813067866978578678622272559312540629469240428032452898866000868980375260973468845045391762128896%Z)/c(2835%Z)*'x^9*exp(x) - c(41085632965459526514242925025226337798823889391631238039975365878020688250513076231433754315571415618970388031535187191264291419748977401123430407835684925068524555493743712308624172579341478340564136904732456431451764550325241804219853976505564541314505617451485339374031442635823642739527386486145802018653242217973697031857685910215128424249290661770810139845506860224489224020147703090041355716065341170449505992168206178549594862334075539481769949279170293277789713992224056122671910728451125460489658377172144739894354379430037360214016%Z)/c(189%Z)*'x^8*exp(x)^2 - c(24617194720516592971129689969072821553161568551633612231935724813851225311131719946426598284620578180135788934073103945131424524619008639560963738247681171354778587715961768887945047111835631936132131053796526208467796193503075815940348411456944820802936221926822364387246762399973010493676677097778452246152718820744607523616881034413011935051325172693598850008038086957328407943152867519676760259023426783868428366096868234752369630475790451462349806333766174399526982696839774056400987238875621667725588761668698895204136615428347347861504%Z)/c(135%Z)*'x^7*exp(x)^3 + c(2618845932599394102119256750335021315474720995032397257834499012365691097073056841761165970280627386527342039738223030513561799199585726776436005730800150480732064483627922443617658957726606135917352773975843552463182825663321057222918984012442841034741461478025590624532571774119999581309790604086867016683059400420145520134319976559503164905653425006427611829995247351034682857958385925838039936882667767355339628611547878075987844774803271813050701550266790033205392467073992699020480798509592298434348237303138765774004880478738317312%Z)*'x^6*exp(x)^4 - c(641978241862897136498942850861885913067490855833379333217805968397038555595956176757494285068272593175103148111822402574760085207422900643235457599092196953262157166545495630345563253324509447339970641629201283269758229214887802298441316517240673760520256614024467632699776510012657077675346235229512895747955575946766231471154384847002735765681564772358665116598846034963573870322137508651941047262208163713064666486211774932210034814439415174079130709637120885825668997598912845088059964351281324350963082763237326269637132025503678464%Z)/c(135%Z)*'x^5*exp(x)^5 - c(120188418734788196610032767691097391591341911305076182314777587170509728484953970238335123783034655622224440043591681942526164415194964019534852283115713269263321872929453209152148657755109062948333206622213582857684544662569259489843910949953262689837541238622757955837183298149992130390720945643520621221219784704861541248286478269849287970131752837128042904719454420250273701995887249954101699186960736276599595198801454259633761350545175557379319275352065183418800456506573293847548184864056039131086368703667319845921628532768768%Z)/c(135%Z)*'x^4*exp(x)^6 - c(136766092548685468261853816732458905499961290465966542740088062634299220556503134555182899291539931232137974859785073097980772219402965035063237012362673552631782195270836823131699940268673973839373178004183063131869083877351755297889449621950349835039012374354098162063291951915206546142582004682483924351393238065437034246505442527931904161134367792367587397080470126117847324957773506499883715405845624286056523283746957871468238986020413740912492968925868487854597142152769793902206487179241633754663282399420026459887757164544%Z)/c(945%Z)*'x^3*exp(x)^7 + c(42419829640699855510874363451765248482315191356888862939202383091286420146973946476380688479200378757345305579920487089065535875971119091790311441180383669775562742830010269603803388373205453330464390247791547975595507903757854453098878746966915574773096177606290751293286052043050498123616617819028168931565193044248894735375773961958659281108750225795631854630819574930168586740178712035082424827617690706192486310473766409311807132226206653399157135609223215562929300411761295801434155586344211647347492618934226836783104%Z)/c(105%Z)*'x^2*exp(x)^8 + c(367957507210855697373498150326113112866154487984335009029156837489950466550059364780098393624202767811803776934649101907733280577494399163456777835259256081564727449442008533458010077415577731211950236846871694649061594970226155001269211567710219803566598524288574717017538919495883595335688185364952916539313747000740903095339509601488701472919010432712529771576947316707029901543647432932584170016742297850068998060998055153568704759352444359370617439778591822739465922937798214044587131704390390075749119119562113024%Z)/c(2835%Z)*'x*exp(x)^9 - c(71924839331207939320285480574444292488549952035811266716811459491789023567957177799831106602235667606709571104669117535282411633819104292148000187887913019738049071177341438194054222091855911792080191857899315090384786458826683295602853532130158748929705601751910543638831724319963600241982665419281630197865587830125795042504507410475691475050547516559253601229008984801736594440372612309021859503810164606194371628568805222821677626936241840437559780538440909869841177910144126925976989397897271922520611618816%Z)/c(14175%Z)*exp(x)^10 + c(527315564053998182729637163459878386039193346411535376744950397267821419032691688622541840711652915160985488846339525623805488144640582482779129108039521331042160483910468659022973914262267959028949124828085498720817416695780685793533917862733982963101069363090321108641989799828319240447237395545028832353206847004861676436540089918457214952419204599519937712468061018830122954048723375794883495971860643352866403248426730912476200463205355721038837487617936374484147112043880656165960233141202731883994975493879313344371026649153536%Z)/c(567%Z)*'x^9 + c(21132862778799311910180175503370476318637849849332695474542811656491923622407660874649198045369540404746925574508496123021862653105441048561195510679252210425841948356832105632167220312317614795086817795190612286377933368526505719589000140139117441457637040577755894233963936248796344923687885532610857845227435131747689478408951378733316353634733151116752259964277684540016111476075066428876953388034760075885899984001098815265968989233056567192646977221149618109424174817203566961032492806570799181441977021870732839068841401578851332521984%Z)/c(945%Z)*'x^8*exp(x) + c(34877068808552312671781310728212043640972904029727256204127725276250387107349040404244915575348475537914293420808029963670366093145195798570153214394371404333204933420009485585656687922606516310088208517542887095288298894961883592843354641087840675160778501905728786661811066506856019360601080909795433194075649301123583381861437965059914549970730911364221939457701596839001555439892814053268670487806741285712091215584257305604429349140172055840591295572768583791009786802504888340964344278462013008956884112387240856921431822399790917877760%Z)/c(189%Z)*'x^7*exp(x)^2 + c(789026537883532133172022712887175508133183971111756407640167854748266248312730270095480189251934757959086469367897209152594746664559647402077132456620654364970134350726846662499478236182320829442847059180095585934975037175818276231972487604723351421466131677103263375697117579939166146249596232066003341275582887810241126523476728799969854256706685544968310299298177357710864186241900136063246961390356212233642429521236562961233747436596928665711247879279187039198913598560729300305286635834412891026759736911151209254479044136327496591212544%Z)/c(135%Z)*'x^6*exp(x)^3 - c(6311134439338095515018558423163401272208012631255013409927975771230484649704189921306043741011038717176826583091116692895917666324573731688106146877748939209747732558562580592023264059265629533846354704819470415236653422018974515741898003927056823016290782865745249750338397147502179273858997542575187492241438274887269365057144813453990102154122226758665009699214122020043976184870895395093716111878180775022959777349726270441400715594484471151589294400028741630181890688191051666599268154377533508831567986689416327019452049188512499499008%Z)/c(135%Z)*'x^5*exp(x)^4 + c(9759535334954299360733878336793895549848780555747436160670794892132785241663038353689409449518928101190446376861481746040082028586782158806992640680967196284570300808291681929056611504764807794814033707114855147419794515541913998415703016007554021802663145572570506042888429278100443893461292549042474072778664834986454054624370783564795364608763131323469077220561543721598710418562491927290150251090287061629815978258803991151686947616652041618959444912332524095920287853885281378508213602831898521554696290788331471054701324214632185856%Z)/c(135%Z)*'x^4*exp(x)^5 + c(1344646279421450206233370855900586857809096411811345409534037307887490003102438401631823851058059071373211320201050647773761510690969616079117274243311290678157419511424523726476711547342016745858260416142857389680317734994419639003717581113837474095549856383279787628815615759120622350136783976963094323925175686062246836418468447824764132505410254403579121313723482867551504672360984043822192872956331786080667023051975096906504002643727523540495735894239027990352974273915726138773968350094175017724666313893557692574440079151333376%Z)/c(135%Z)*'x^3*exp(x)^6 + c(736642454996468905168327033057772156249231957224818572489300455914112233445605271327572649547328864500240071714764744068473263230531686291473373483911851417434906153320260864678584190174011308177759376686463210996368305241443381415150160172197265236372974557557531579277886907964767783386408957866950701839319634461400070819607182975809718532002475516457235954225192224120780082450691572963409092264349511740802360489570651881480935856582931556766765007900674330460466195629598535031217307515518962608269583263708522045818397523968%Z)/c(315%Z)*'x^2*exp(x)^7 - c(4503074241771424848451713416323666960578231642429004606929519617878754192392046885890802803482771189396404833017044933194218226549276417034730280067689919478143268827524237659046887730905901502588300443889360462167044908131446198932134139631990633406024610144690201302538856132209929882605643727108848521619661539566882869820312766817428292071948997402248596230012117157092588708488830798175525824319104466121072119460148996393277898596364623011237196959123482307247192994208522811352290789047649380981936418872633099059986432%Z)/c(945%Z)*'x*exp(x)^8 - c(2286067299786955903209672914443468126923958523662652101031438141089006224054375937130261801652986660000825191782336776432857601265685832257416662587975094009213416936628870470096709586535093034836752476157918863573288142561330755519564533158650384290649808404498700398346037879382149772443342016092744770664798661413734355776064821740740707282861715609748511944787565795520823071659400405071653473954744707444843901722976860955422684831131958151086883122675862257174500969273047425367676311700585571777184755776451772416%Z)/c(2835%Z)*exp(x)^9 + c(164712446582740426542546704342039080086412115331355249343440496599618454145929797667598917886905879100312941282487307074372852620785513985052396173772853181198569608925388364457826129402436817186159134237774193325627980853094243933208291430944159924903949455469576180319585370275722560307857614455129330225811578902553721337755162405742535975299401934067606690679378702960026660350414458686725412019625243308304698858802090175589878557171449803698519455934767023437451730849335018103824410911009127949521218955198049319970344980222836736%Z)/c(2835%Z)*'x^8 + c(218086330448149609162952705486412626491440484782409951115624817026079088308718093464196935717521795925815744126052827672096762747774859699863436854616202478841261814109540998082429575298931879731429979121952525103880068218607853384199799792012264461025641676434834222983977299148466500640854557508129450166644671191932812730234572276065486578016278224424922027455930433330432420673040548827667575682767869229016716863529773584362722385383079117008730301114789753122743223849714827543138717998194777992935119006263626518948512442283353937281024%Z)/c(315%Z)*'x^7*exp(x) - c(60857469386751711578192629570104999762844313424440894734159619268344372660430544500585502301259984515171889290182541601785439573580001296273683512792009511533294170985088931927754478007327785144437481980413951138167096616077199921575205225298016085601765348809220385241248572086819025028778250208031353543009175506236138739268424993098962189007217954574392925215025949555162005864194476108161064345962294203057085591542506399713612832342312590487721495440020640263645580748824716192834182239710925849794995438378830659522096498020134110386716672%Z)/c(675%Z)*'x^6*exp(x)^2 - c(85810923184462370714027784900043760063869951071696727132334370805283704035223763081253896212373546968325976458791564149507259484998615277763229446263897784874182544285228087117079211668841611752556897694609021197292747381771642327993383696028262329662278651040484610352286815645622900626206107539799885600384540434786205618957824895806327235139229320990385606594118433220659473793839529890583128677866896380575389726061581678642628740488248837539479951211781106699370735692426776084493265954649274958669139908394344340554850889029057437973348352%Z)/c(675%Z)*'x^5*exp(x)^3 + c(24266138752330828557196025371666926105697652843893014504712492822716493155548127519452651977263230341075604151151340435475685282743979684211666412277846722018773821611915678253201324784013625825254561893176061461077190337080761171950095947206083734698781679406218653839126370197843345416564597369681759868372619280721751345690900389995267867498661816171179484974114695473739349095391311922631387992967150720402326353699500788818457537217087985543584757800246217648606648750434971724675362276125787015066191581490115853483881336571795295174656%Z)/c(45%Z)*'x^4*exp(x)^4 - c(374705545971175613030175103793189926223859479031926964262950688298819094498223548328276206145641194046671960326627384105021665074817765807214417902139415797981272680202257200646536800344479885899027498149158378861826985737821649555842955192401171982617231534206004812656875048622841169131167338217840683289946706680810843721504892888927586985208599784132217524678242336293698421682292730446131879023117078449102364529226112272476380934546301122851894957884673443434530724766678419531602698971401780776060591487656777278253540592268821397504%Z)/c(675%Z)*'x^3*exp(x)^5 - c(974681796663242774250707453914134259158143589729547746056262604295409847691476351875891271225620936585459670122874609646661676808375237672551371864798434219474546934385977737555915020275202544960883890779472259509158946287318291152740638697269757722842489430450653754057948333901222976208659996244883870116990835946361376131839211073211301787165903106970608998258377555901418585985972162001510273156870745554452413240311708020394374809692313275524286695005469576279832858096498878638386348189743453286454671564767960650387387186151424%Z)/c(27%Z)*'x^2*exp(x)^6 - c(13518435258795784576671974992472458063064487620375028812128960951589860027462023552019380788385903346547803338896458555841169504248506427382744425680127624957632001778664993799481045498890893102289289855873939238909729747154215564760343706736862686284841987902578322184073176992527867477661663319461927796658511770851092380407259553494489044059449883107642442772393803863040027700929590480884402769869581084359459046649981502428041295345762004262686038393905002950602822368105455461904078070495320672116911007054136450183697784635392%Z)/c(675%Z)*'x*exp(x)^7 + c(104119866564447389327346179194568443166333313466230523176752084630872603581608918326914780216579680176952641557975317989827760386696291435986281768010350472255769645766559066232921085279313614642868719451478852923035196774306414230389875251902050760017456801310805121172306957730793523519243562931447734627317056396412562679338956573496296185173872407711103979883619165351455480585518155010927360469030665063157097067183651402138263810567853791932439443641180634341185264291257677690144268113103402497725160323984051373997031424%Z)/c(4725%Z)*exp(x)^8 + c(1785087260565674025660789987411605824282536156464050716818596764708075337653554952457329041313928656596935853382836592608782637699105817002911102415023955735163920626231002970374383564753727747572868656176440806267883315867617765047340407957182258158388199237487264178003360954819293190407569184189424487127741095473873462847320843247726183209712159458564442424028222179236160199183414355940093403157199858073230946458217479877351774175387305776606077194479676292703461547464862115298335833109750097760360456328257150298628413796944707584%Z)/c(675%Z)*'x^7 + c(10982635029466052079374998188252621081908620459389027421036321603506545018523542557649802802925090849985540273590666277986019745897088115980722461673845964546144857874024449283799195671050504816609532262028680888721041490558331320584383998275000735942427180143937707897285017729386711313802250964708639578133298627879520235299172319176486527209807000864199378441721640366298995826417270037186496101348609018542468971463419243609202840624890430533069085329730894456506098790734263198068158212551085186134454744480266396728523270194212959732891648%Z)/c(675%Z)*'x^6*exp(x) + c(63827345588230172248576292225919792626429325799480442031256971409648840439760576219095632015488219181439557139011024444938870587464730954567918976586834225228065781275411783084843919812950015301597072882874422058803656994346295861260648326856025900797898080351259335283890407538653416642069366499285445454519223471553758606399209574940405624860689813294534193023092353961152356862953986708486053526711235489805855901263940128024302255087043729374989709818205204745174711798489351247444085999613701846117150820641949977853688502509029951897862144%Z)/c(675%Z)*'x^5*exp(x)^2 + c(30528716998984484845388454954419028595696734456211444645608152390281512487723252900148206798759378421824009604313184828438151995911660905841166136421735076981476480921309343009304712953516450208026078509950785533681395813048632353143087362539064186765143593704153108990211623512020262685270115426714895186246009394350383797509044198970658504326621140901300455682918510938126372636745595677501212660191216792339547291275347797201418269072429986376878537505139457555659126438092541230877783533682064859206902857545398716040048864259184636679159808%Z)/c(15%Z)*'x^4*exp(x)^3 - c(459798170924250715139361659912081804140402746400784390069193081327409846428220044317821094143055281183584814817235048572952523566102693223416093163724955162772855038539285516882301692625247934176469974415197982964894143669418936583331049572125724580326554904010930707314489308435126138640417730620655681377103886315383076952712004207754304753932286625378366757845266349928902077789306046075219991945054787767894127601180905163386891430671061677953526483200338598432843381508355729422408348771348130195810284393356074962191632344376304281321472%Z)/c(135%Z)*'x^3*exp(x)^4 + c(230438545981380337314273321076403240415855758743033567653404009481541935742299541396932277262617411612796983690718826716337644692573318076439909938626766460033921447035649235983768114483043331115785081303942170539683806556623838662301473017095405031414751082836111098508014451812705243337411396792298792040958548014806767413372084192132671097978309369288168907933386588294762137235980703652448057032323865819050390866791068954697749519183281760161055509308405757409427255912361461272586116552481576930853818785817737254526707530767571877888%Z)/c(675%Z)*'x^2*exp(x)^5 - c(7010116066528063689210729398771243017845590601637564701277239637210708377374028733815066394779207729296422436622357901949477528995255862280554489124727029632779915265808408338722006404328912368595237405701929144950461405377646856715828944320766906421861573286129449963125021192692806605099589564125468408081119669480902829758364239656622402720009897895084816276415690318806355664536127775229203461733503003277132551763315452577151947734838088971834632801935893227840466653116451933967602541503235160426792025907691388105269340522151936%Z)/c(25%Z)*'x*exp(x)^6 + c(68296079736242944519719033138601002055863889309453910915034091178682461895544369924014325332760285177861729359622637735001432437014434582213475856462238272802159294952490847236507974030163700307790964098433721160082083780415759151694597589704392816901726915037614253756049881451451670331602870899876669267314877078599405524415754406615990590806107637412974273141712103804395582831141912387285687366047320381794105774965774338875860168350167027981037336742385821729088351886204312762199796337008229175498418458826608728933838427783168%Z)/c(945%Z)*exp(x)^7 + c(546184907114341335545175366991679358882836665071582438676033588355681670069279861037408960737933583247716925928080614396012391699111093678068916597596464361295845454952009711605570158271039754594564838643566628099244810650593381466021030497051264051776849409962658129821006740240697947837582605387891950580926980672878296784808546145483347289489262201257219545965137266050562216851305255834482558416402831910925520907833699130107045240775169599499030567288813576890757859004694939569456262843098073019901450907526885594259480914463454920704%Z)/c(6075%Z)*'x^6 + c(834079940412283694639285897197845012855645428483847054361822493788269292965597144305667481680435923263143007858610574673256773951227638484487188210822786639494857969267286706726234271260169468958224844388836543925639773482009427860002396026579551755043702435428944053641749382580462458796704503963905732963372738888602548563706416510024433358764734307874117007778079121792299502024331985080272042314892714655875010370043661003859933761490632208451147221503454183462179927039684622331554295451355316162836782697204296754936662620658491599437692928%Z)/c(2835%Z)*'x^5*exp(x) - c(13342221224196001452484848081578525143053427954755124182353787525245137300559772125299862082289221723505660502228300991112554559577776478033435029220607759427370950530686514496433312062563510806287029525702746583944523727458130541987207525514508982630712883560303185118980498256021185230161649106520825507837093714298667841162883066896807959616012635193183384821119906678005554782503639655017487586531205095861171676525328006854883108642073020760922495323753164280406343870958873569157284810958851867149121443042993090521418097279417990347619303424%Z)/c(945%Z)*'x^4*exp(x)^2 - c(65542989877959131596848204782523603143218182369902576762263155952242678142441177409027017229502103680704134739988620334220639435315045353607734011089248335944697686816006442668404445420259515321604234660059997623068572304315418650606043596344766491397433239925012505760002669305398080647987763600625066310267380101018039239403058233970667902215474277187219081488615674176619389116762689343962413250961398484281620025604615844011502105924133211725398701840769042323576076692196361439424911589965899162790754523839625724093867993440867194665806331904%Z)/c(2835%Z)*'x^3*exp(x)^3 + c(4166886683744245119275624417863807166869798239684213720491813960277201521550658381005933923150313015686522320165218010154511513054781156392191426297172995599063621613996478706903089526135956125995006340539123339200120581310197821160241258533577739339504719512567547621556882860555928774187651735654544863809582996239040779454490858412090468828760444332669573240027474173944301998913594571637279934875203592110152879301288023527352190452360962890661361875991741661523589127776470665038828855771486520551307243950438960675993598977447452196470784%Z)/c(945%Z)*'x^2*exp(x)^4 + c(8377073289742308299907590671010800860218112752005754494363323081206035305656626261281610681837263362750516467148413353844382471673401799731430350916262101210560763495247971908397209364082653981310426874833621470415075797876792521826910866401346793371592463858793310326611013506156503839183905009147309385503347054912365027123934981132988176877386970950341701312743573760748494751767737174483709750068740907398767011025772566089753150942929016447401023015132545174760268264337112471920255808411683008211121534620819373423656738384023295885312%Z)/c(315%Z)*'x*exp(x)^5 + c(32959245818331769013871972212682999795248284670196525189781581840563954110300596356643659677850076812291383375732066819587221895950440768378062725655389104591828601315393363716222453061495760572273479714816499217759855384868691560880626774860201702413371944381729922632454031776207553113436482681848127230861193703094300441333677178655515367243397302032917383556962385871062823432687462496104788580577868744650040366638485593556079946874752214467643155538398414303258588990646902653713023519564343460924699315659652837981584575511723507712%Z)/c(14175%Z)*exp(x)^6 + c(434610461286378072419094830922883099851790270453551974283919428728685249764728758942013033448961243403530097749039697362031148691882771664430740264870664831336190297564870780853832417922583686728684770235137465222973154050647470549913596253731754343514595524786258141903014265446005863108752031266937657984899590984131378227167336386100021293528599469355541060466540743930981029192777199641999734453465367026548078487515624823433704533421943804961463540341432714636360858682030546185800138235773636620478157158710555770122484022119531282432%Z)/c(189%Z)*'x^5 + c(11474879205053055527715128539303671940460386375416905507558698757885698767078615586804061337655686356700993652743084317847619788717335622467646496612606158903354123813242588520673304529451048040390835059133852011526860910121436247072779807739986296826026196126403838854983416008839698000473984606148178746188116196229077006872295267104539302365955541836589809120237225253832242256674509814154862772406409101133683022409360717685165880959215851614598986889199930342316929274232008567537131961764265345231848196385453736459965283176777353148667789312%Z)/c(2835%Z)*'x^4*exp(x) + c(4280872398467140914879787475251254209627276496174048108588002039255779247733828259191685559765998765815495189910860819639783055382282116003025391901807006375109122237692434467017940015683904280140395552817338486405865820770428976483498600216815272868212322610527057982988161768400980481461025621832785509842807862718630583829670554795282173706063932626834302060529112299664377827631898252018166753634998671907038254869248240338433509196004665854797372613913735806539576604973013287427975925447244602066845871865258376999797082635559276282785038336%Z)/c(315%Z)*'x^3*exp(x)^2 + c(513767469736204044163732476769550300724111459076571132447587992654450979830255053609684577773626618859980648564336169130073090543778127847343359741024131905234414864066018874779547628589378056008409230917212993554478389598702702017154366248228687295801902138639256382146746692841400688680321792672171402300697783050486767687893134310793936944376740723196276811690212814308306248648727739554484406123702795865956859296967318903682569306188252932231451110964002310955048562022940779680299770822075101178717674201656283670917483440301783988668291088384%Z)/c(2835%Z)*'x^2*exp(x)^3 + c(251100113019847490088545152896022220015990003069943242242367351751053445700263135895791526333705330852918050437298251788055058810363267010431540610931735276730553511014576417444271149743932537985614468049716442121474083173462981670505831695012251853342676963436349330320297927610125810582606816812173106981193385011562795884212430651921388634920120657129370661471372393234369772835912993463354595946898223441357909561579486559509278756934702478194301319317379806578990547268344954465902521196515087422559620119879924927449760541898994043829878784%Z)/c(2835%Z)*'x*exp(x)^4 - c(406591934454587743602696443913098533913113522741828595202344319116531185578282889958057694809442296352016416414768824519146404440516448067326678882488874956940728409357555373678768237597543063315458309718000137378559911796793738165505270716600822783111302330103863163517834943942732573509085568218820045460330309427705534759243540783275610422029338148833966985205429531647225007328084523727237681793706154078435466617732191317294112514614080555663674998654880149276950479999744261671492680235365171503167838019204402941802862568425284282875904%Z)/c(2835%Z)*exp(x)^5 + c(373387552798540604858002095979908553498738328599007667032384548783878812340299928881341857360011386970203598294591167905279286530417167571496606645278946565133717108005988382246949909315625282152740651416291248907780057741316338230193811853855068353529193530425831196719177523360165128316000619555656540817454322598008733407402407210989663948734851918667719265021809263914430117830584167342173562146566275681206207033766356372438205306034296399522513221640114620926934926232055965023621178413753997048904113920344461029793736462995761318068224%Z)/c(8505%Z)*'x^4 + c(83689570436556700214944710651678297639501799176973709641553933086694318453354680079661239954674471566752287893798608258237776171637486152106169669051815656696260693194153533171760055462113391219309085255182124326154665803951983372346833463388467186779199065956358807768739288406307540174526029131434217488922094686858941403058374412842321387475454143957125515421454188679700002011490954147485193994801239170957158787923868620639541513493915786648940094874751466344473740937154786463970392213520809000186625434089398185799958283885151396653942439936%Z)/c(2025%Z)*'x^3*exp(x) - c(1102935597768977260053519713850386822393743638471115553135994988687074694653200061556123180774484930545171105605270201241090212971166650331829168779957282779791890225799336407921546049227973970302881052837614085651844483895629610429755316872380125515647757497302780167850309119285753803792071150567140394144762662893802224723884755543802441537985849671113377709830600017430326834021550585104869576761046899926054047277600266005894577783182942232592488639381769701346463584549576661931806403489817558215353601681118871959957286777016088808241103896576%Z)/c(1575%Z)*'x^2*exp(x)^2 - c(12431868508357801091126744950067992828943963868549557424554694807717808291156439297062871164901005958438524421996322352463951244179669057964788653297604196547893957613278933337694735355540293343604986681959822084346555551735930729075536534708497327341620077639156034041985582596607649983338494961127935343752237292417306912103753801758655369230211449940635074578996058612228748966133020419783109738030810914422968001883777191955588570322974792687510502019804166414889951490850111708670183199377028780190092495315326761790927873714086382690954356195328%Z)/c(14175%Z)*'x*exp(x)^3 - c(6323339915490114775316287493687776833911221217323740637745516816961092688364447127549588933432063791557942868720208754177395986984527693279031293996654440895513514359811093822407733361389488091442736977738491735913278758446782737125656607732642591539392665024774075802955030809993328634735203448289287526442780671283070645273574109817011292418737130123634023287304386426271450447394183398713075283920360666931436452856322551038013473298785348158127511475527484556970659672323533484385966935729569370153299085566290806313942558287254743325748494336%Z)/c(14175%Z)*exp(x)^4 + c(8646598965170366660990741055711579731793950728959515587580400181902927411378992449686762225987894928924241593320553702716847133683364585165077434770276183583669451460165644945004230293375346285210401824233451393289169379395465955310425909367784579947774730900570261450666002141904848377805112861766508542296084451178223265748595392282012040355227344334851530268924679624125114809174354457854597246914077050124297984182544414969847427041101196805676210303632323478680353834009304642387836784864834743240656862514703167536057327857572857656639488%Z)/c(14175%Z)*'x^3 + c(1401008626438532298219387849576557679136253109146501605754933020029221627399298970977738581551608871186732012124883361594486179046040455817511619005117635746404489535426199509114919125358430341713258336855750270290423190310190259692005964984442742540914466378783682607749046857747691041379784711198884714957012317174258864108645152468974083617303871450737300006756100665794734138443951987910383255546029218422131609326638949965975028022948506087964562513179953150397122438456926920962376217543379089926703872705675667413573098252775479273162627088384%Z)/c(4725%Z)*'x^2*exp(x) + c(2007694467892346912661430421874098491176582349936908020563123506543350697646159377442008623639554677815408833560456950424650036261673851224455423906612901787526057144002658906531154863306607469033507449214151343231608565607863728137232470870002461417491823138612208737459785470657198873011096661762718194305890444279221751772416696663948842867619401394795129675516903790610785622233499278455837800463966773282401015669914043879761134637441618349762704237873788276054543284319274051795666790289257613697379892218615549084535359892843745375079217758208%Z)/c(4725%Z)*'x*exp(x)^2 + c(5661921967001187173254400391274460288688429814598843801821852958123237359805482493088077580835865075123177367423187912874778780745156134227901851171615142521007444026258670251156485627151503058381512074275418463305052335953626754284527702589501406013016756963055768350051530458042561900691074178844520276450226671740504149245286969441543620162696253889873320970442082303632012821094604776151989316556476941917921378780085666864649117045538615124696322731884797688755586678450533030562178222299833630127047634864116843219290769794630334166646470475776%Z)/c(2835%Z)*exp(x)^3 + c(304220222013105175317060544000677845366864091591226429587391330479198558820162600295210333207256675114562387466068308466112309696504008686895638301535107239177147967630733646142626991682093720296126797910908780363409476250743060784478663501026565500333991616041082702025019078400744578773553153590675840629207396886413007462707493152526357163789655552450189489074233325632283026147466945280097157521759022302656449383059332526931588853646090414328688768309760244940550266113449712735728534683361722089205303982604814630005295279488646445598244864%Z)/c(51975%Z)*'x^2 + c(4646268274826579140762692042851823038551069517654491522550346505996825001635303770549010319446451729066976795800100430473269245654269670187346232022592003105880732554414002456198771930834036460919827994759596604400636242734193027718611625160243876158481368684520478073281701375492781829375869524389415187406874434965621354653890512955573382578763599389891379102801407444819205280248975673105867260033595919480432269965507630273377277207616275646585539682467009139155816319955546930731668760220156529327035953726139349673915159726755930232567818616832%Z)/c(3465%Z)*'x*exp(x) - c(84576911272130010488187849727014381880222199023918870184744910008582582899005983280666842775771921898076860076971091547053300593100694315337064946484062325189730981785795348516142563829098135173632436343769040420064533681159907804748642831672875247916766183791657146000130653809767120330786136484600839204875781695829270687189695764730252256885581537322523360901825587774205313556751528191746878575438268436937570057413393289527533822104630098145933697085244667240802324476866721099189517949017885600524057715704171698110175233416381297949579971395584%Z)/c(17325%Z)*exp(x)^2 + c(3446890644864389964039459323353387623289094256089117838068258324899070650997000332103672147416056657771146423277249302135804046230763070416655458425786897575680207118112617965792322032723656384640082650326198097665271805465278479551317789528771615298276207862381716802031788991406164532193396823850031127534822094700979068221016252866381216152539268007911032495582893896404733165139811350558080139886748640174365221399398699338290175014595897330851503477820151499660492484143555500482531745534171316023309560529117778462231744679611619356966912%Z)/c(99%Z)*'x + c(1999293055061046455442046175532509207251620980339643670070481147535053102087369620680067435996205528383128213991407286433435571732620255639183842618987953047433009430394125497575663464741108923823751754571823422012839424960285243213730298388081022527357873178870811573275999571085665459353150842761714771111063472813681181097696830976081440075064274521447345231906682161028848374285712321427502198073219077588026417509812861432165674420022503923803235027148696570700428538011308669998574131373786843799086486435657395067571741122461341836198981664768%Z)/c(693%Z)*exp(x) + c(97065747209047184443623179382393256793278917523785895085539970118891492971252045707030684131529066787537582232399333937636835076797337658031200672798146564796322485222878775014287142473651385680389443025521723765367926432284199302365054060807048442880450126799873033565221191639903266967084294073799741566501296036794458742945901865178906482277992065021525042568426411886509240275578539450072416808791574149181408133886351830425531143006890234137605644636508465391312165513359500196494705692456278514138162286320532483445294730679018131966350%Z)
)%fexpr.

Compute ex0.

Let vl32 := I.lower (I.mul prec (I.fromZ prec 3) 
                             (I.inv prec (I.fromZ prec 2))).
Let vup32 := I.upper (I.mul prec (I.fromZ prec 3) 
                             (I.inv prec (I.fromZ prec 2))).

Time Definition ex0_cms := 
  Eval native_compute in mk_cms prec 100 vl32 vup32 ex0.

Compute P ex0_cms.
Compute Delta ex0_cms.
Compute Delta (norm_cms prec ex0_cms).
Compute P (norm_cms prec ex0_cms).
Compute eval_range_cms prec ex0_cms.

End Example0.

*)

Section Example1.

Let prec := 165%bigZ.

Definition ex1 := (sin(x))%fexpr.

Compute ex1.

(* TL = chebyshevform(sin(x), 10 , [3,4]);            *)
(* TL[2];                                             *)
(* TL[3];                                             *)
Time Definition ex1_cms := 
  Eval vm_compute in mk_cms prec 10 3%Z 4%Z (sin(x))%fexpr.

Lemma ex1_correct : cms_correct 10 3%Z 4%Z sin ex1_cms.
Proof.
rewrite (_ : ex1_cms = mk_cms 165%bigZ 10 3%Z 4%Z (sin(x))%fexpr); last first.
  by vm_cast_no_check (refl_equal ex1_cms).
have-> : sin = (fexpr_eval ex1).
  by apply: refl_equal.
by apply: mk_cms_correct.
Qed.

Compute P ex1_cms.
Compute Delta ex1_cms.
Compute Delta (norm_cms prec ex1_cms).
Compute P (norm_cms prec ex1_cms).
Compute eval_range_cms prec ex1_cms.

End Example1.

Section Example2.

Let prec := 165%bigZ.

Definition ex2 := (atan(x))%fexpr.

Let vmz25 := I.lower (I.neg (I.inv prec (I.fromZ prec 4))).
Let vz25 := I.upper (I.inv prec (I.fromZ prec 4)).

(* TL = chebyshevform(atan(x), 15 , [-0.25,0.25]);    *)
(* TL[2];                                             *)
(* TL[3];                                             *)
Time Definition ex2_cms := 
  Eval vm_compute in mk_cms prec 15 vmz25 vz25 (atan(x))%fexpr.

Lemma ex2_correct : cms_correct 15 vmz25 vz25 atan ex2_cms.
Proof.
rewrite (_ : ex2_cms = 
              mk_cms 165%bigZ 15 vmz25 vz25 (atan(x))%fexpr); last first.
  by vm_cast_no_check (refl_equal ex2_cms).
have-> : atan = (fexpr_eval ex2).
  by apply: refl_equal.
by apply: mk_cms_correct.
Qed.

Compute P ex2_cms.
Compute Delta ex2_cms.
Compute Delta (norm_cms prec ex2_cms).
Compute P (norm_cms prec ex2_cms).
Compute eval_range_cms prec ex2_cms.

End Example2.

Section Example3.

Let prec := 165%bigZ.

Definition ex3 := (atan(x))%fexpr.

Let vmz9 := I.lower (I.neg (I.div prec (I.fromZ prec 9) (I.fromZ prec 10))).
Let vz9 := I.upper (I.div prec (I.fromZ prec 9) (I.fromZ prec 10)).

(* TL = chebyshevform(atan(x), 15 , [-0.9, 0.9]);    *)
(* TL[2];                                             *)
(* TL[3];                                             *)
Time Definition ex3_cms := 
  Eval vm_compute in mk_cms prec 15 vmz9 vz9 (atan(x))%fexpr.

Lemma ex3_correct : cms_correct 15 vmz9 vz9 atan ex3_cms.
Proof.
rewrite (_ : ex3_cms = mk_cms 165%bigZ 15 vmz9 vz9 (atan(x))%fexpr); last first.
  by vm_cast_no_check (refl_equal ex3_cms).
have-> : atan = (fexpr_eval ex3).
  by apply: refl_equal.
by apply: mk_cms_correct.
Qed.

Compute P ex3_cms.
Compute Delta ex3_cms.
Compute Delta (norm_cms prec ex3_cms).
Compute P (norm_cms prec ex3_cms).
Compute eval_range_cms prec ex3_cms.

End Example3.

Section Example4.

(* The precision *)
Let prec := 165%bigZ.

Definition ex4 := (exp(/(cos(x))))%fexpr.

Print ex4.

(* TL = chebyshevform(exp(1/cos(x)), 14, [0, 1]);                 *)
(* TL[2];                                                         *)
(* TL[3];                                                         *)
Time Definition ex4_cms :=
  Eval vm_compute in mk_cms prec 14 0%Z 1%Z ex4.

Lemma ex4_correct :
       cms_correct 14 0%Z 1%Z (fun x => exp (/ (cos x)))%R ex4_cms.
Proof.
have-> : (fun x => exp (/ (cos x))) = fexpr_eval ex4.
  by apply: refl_equal.
have-> : ex4_cms = mk_cms prec 14 0%Z 1%Z ex4.
  by vm_cast_no_check (refl_equal ex4_cms).
by apply mk_cms_correct.
Qed.

Compute P ex4_cms.
Compute Delta ex4_cms.
Compute Delta (norm_cms prec ex4_cms).
Compute P (norm_cms prec ex4_cms).
Compute eval_range_cms prec ex4_cms.

End Example4.

Section Example5.

(* The precision *)
Let prec := 165%bigZ.

Definition ex5 := (exp(x) / (ln(2 + 'x) * cos(x)))%fexpr.


(* TL = chebyshevform((exp (-x)) / (log(2 + x) * cos(x)), 15 , [0, 1]); *)
(* TL[2];                                                           *)
(* TL[3];                                                           *)
Time Definition ex5_cms :=
  Eval vm_compute in mk_cms prec 15 0%Z 1%Z ex5.

Lemma ex5_correct :
       cms_correct 15 0%Z 1%Z (fun x => exp x / (ln (2 + x) * cos x))%R ex5_cms.
Proof.
have-> : (fun x => (exp x / (ln (2 + x) * cos x)))%R = fexpr_eval ex5.
  by apply: refl_equal.
have-> : ex5_cms = mk_cms prec 15 0%Z 1%Z ex5.
  by vm_cast_no_check (refl_equal ex5_cms).
by apply mk_cms_correct.
Qed.

Compute P ex5_cms.
Compute Delta ex5_cms.
Compute Delta (norm_cms prec ex5_cms).
Compute P (norm_cms prec ex5_cms).
Compute eval_range_cms prec ex5_cms.

End Example5.

Section Example6.

(* The precision *)
Let prec := 165%bigZ.

Definition ex6 := (sin((exp(-'x))))%fexpr.

Print ex6.

(* TL = chebyshevform(sin((exp (-x))), 10 , [-1, 1]); *)
(* TL[2];                                         *)
(* TL[3];                                         *)
Time Definition ex6_cms :=
  Eval vm_compute in mk_cms prec 10 (-1)%Z 1%Z ex6.

Lemma ex6_correct :
       cms_correct 10 (-1)%Z 1%Z (fun x => sin (exp (-x)))%R ex6_cms.
Proof.
have-> : (fun x => sin (exp (-x))) = fexpr_eval ex6.
  by apply: refl_equal.
have-> : ex6_cms = mk_cms prec 10 (-1)%Z 1%Z ex6.
  by vm_cast_no_check (refl_equal ex6_cms).
by apply mk_cms_correct.
Qed.

Compute P ex6_cms.
Compute Delta ex6_cms.
Compute Delta (norm_cms prec ex6_cms).
Compute P (norm_cms prec ex6_cms).
Compute eval_range_cms prec ex6_cms.

End Example6.

Section Example8.

(* The precision *)
Let prec := 165%bigZ.

Eval vm_compute in 
eval_range_cms prec (mk_cms prec 10 (-1)%Z 0%Z (PI)%fexpr).

Definition ex8 := (sqrt('x + c(100001,100000)))%fexpr.

Print ex8.

(* TL = chebyshevform(sqrt(x + 1.00001), 10 , [-1, 0]); *)
(* TL[2];                                               *)
(* TL[3];                                               *)
Time Definition ex8_cms :=
  Eval vm_compute in mk_cms prec 10 (-1)%Z 0%Z ex8.

Lemma ex8_correct :
       cms_correct 10 (-1)%Z 0%Z (fun x => sqrt (x + 1.00001))%R ex8_cms.
Proof.
have-> : (fun x => sqrt (x + 1.00001)) = fexpr_eval ex8.
  by apply: refl_equal.
have-> : ex8_cms = mk_cms prec 10 (-1)%Z 0%Z ex8.
  by vm_cast_no_check (refl_equal ex8_cms).
by apply mk_cms_correct.
Qed.

Compute P ex8_cms.
Compute Delta ex8_cms.
Compute Delta (norm_cms prec ex8_cms).
Compute P (norm_cms prec ex8_cms).
Compute eval_range_cms prec ex8_cms.

End Example8.

Section Example9.

(* The precision *)
Let prec := 165%bigZ.

Definition ex9 := (sqrt('x + c(100001,100000)) * sin(x))%fexpr.

Print ex9.

(* TL = chebyshevform(sqrt(x + 1.00001) * sin(x), 10 , [-1, 0]); *)
(* TL[2];                                                        *)
(* TL[3];                                                        *)
Time Definition ex9_cms :=
  Eval vm_compute in mk_cms prec 10 (-1)%Z 0%Z ex9.

Lemma ex9_correct :
       cms_correct 10 (-1)%Z 0%Z 
          (fun x => sqrt (x + 1.00001) * sin x)%R ex9_cms.
Proof.
have-> : (fun x => sqrt (x + 1.00001) * sin x)%R = fexpr_eval ex9.
  by apply: refl_equal.
have-> : ex9_cms = mk_cms prec 10 (-1)%Z 0%Z ex9.
  by vm_cast_no_check (refl_equal ex9_cms).
by apply mk_cms_correct.
Qed.

Compute P ex9_cms.
Compute Delta ex9_cms.
Compute Delta (norm_cms prec ex9_cms).
Compute P (norm_cms prec ex9_cms).
Compute eval_range_cms prec ex9_cms.

End Example9.

Section Example10.


(* The precision *)
Let prec := 165%bigZ.

Definition ex10 := (/(1 + c(4%Z) * 'x ^ 2))%fexpr.

Print ex10.

(* TL = chebyshevform(1/(1 + 4 * x ^2), 10 , [-1, 1]); *)
(* TL[2];                                             *)
(* TL[3];                                             *)

Time Definition ex10_cms :=
  Eval vm_compute in mk_cms prec 10 (-1)%Z 1%Z ex10.

Lemma ex10_correct :
       cms_correct 10 (-1)%Z 1%Z (fun x => / (1 + 4 * x ^ 2))%R ex10_cms.
Proof.
have-> : (fun x => / (1 + 4 * (x ^ 2)))%R = (fexpr_eval ex10).
  apply: refl_equal.
have-> : ex10_cms = mk_cms prec 10 (-1)%Z 1%Z ex10.
  by vm_cast_no_check (refl_equal ex10_cms).
by apply mk_cms_correct.
Qed.

Compute P ex10_cms.
Compute Delta ex10_cms.
Compute Delta (norm_cms prec ex10_cms).
Compute P (norm_cms prec ex10_cms).
Compute eval_range_cms prec ex10_cms.

End Example10.


Section Example11.

(* The precision *)
Let prec := 165%bigZ.

Definition ex11 := (sin(x) ^ 2 + cos(x) ^ 2)%fexpr.

Print ex11.

(* TL = chebyshevform(sin(x)^2 + cos(x)^2 , 10, [-1,1]); *)
(* TL[2];                                                *)
(* TL[3];                                                *)
Time Definition ex11_cms :=
  Eval vm_compute in mk_cms prec 10 (-1)%Z 1%Z ex11.

Lemma ex11_correct :
       cms_correct 10 (-1)%Z 1%Z (fun x => sin x ^ 2 + cos x ^ 2)%R 
                  ex11_cms.
Proof.
have-> : (fun x => sin x ^ 2 + cos x ^ 2)%R = (fexpr_eval ex11).
  by apply: refl_equal.
have-> : ex11_cms = mk_cms prec 10 (-1)%Z 1%Z ex11.
  by vm_cast_no_check (refl_equal ex11_cms).
by apply mk_cms_correct.
Qed.

Compute P ex11_cms.
Compute Delta ex11_cms.
Compute Delta (norm_cms prec ex11_cms).
Compute P (norm_cms prec ex11_cms).
Compute eval_range_cms prec ex11_cms.

End Example11.

Section Tang.

(* The precision *)
Let prec := 52%bigZ.

Let Iab := I.div prec (I.bnd (-10831)%Z (10831)%Z) (I.fromZ prec 1000000).

Let If :=
  let z := 
  I.div prec
   (I.bnd (23)%Z (23)%Z)
   (I.fromZ prec (27 * 2 ^ 33)%Z) in I.bnd (SFBI2.neg (I.lower z)) (I.lower z).
Compute If.
 
Definition tang := exp('x) - 1 - ('x + c(8388676, 2 ^ 24) * 'x ^ 2
                                 + c(11184876, 2 ^ 26) * 'x ^ 3).

Compute solve prec 3 Iab tang If 8.

Lemma tang_correct x :
 ((-10831 / 1000000) <= x <= (10831 / 1000000) ->
  (-23 / (27 * 2 ^ 33)) <= (exp x - 1 -
                                      (x + 8388676/ 2 ^ 24 * x ^ 2 +
                                           11184876 / 2 ^ 26 * x ^ 3))
                      <= (23 / (27 * 2 ^ 33)))%R.
Proof.
move=> H.
cheby_solve_tac prec 7 3 tang H.
Time Qed.

End Tang.


Section CosSin.

(* The precision *)
Let prec := 52%bigZ.

Definition sin_cos := cos(x) ^ 2 + sin(x) ^ 2.

Let k := 40%Z.
Lemma sin_correct x :
 (3 / 1  <= x <= (4 / 1) ->
  (IZR (2 ^ k -  1) / IZR (2 ^ k)) <= (cos x ^ 2 + sin x ^ 2)
                      <= (IZR (2 ^ k + 1) / IZR (2 ^ k)))%R.
Proof.
move=> H.
cheby_solve_tac prec 10%nat 3%nat sin_cos H.
Time Qed.

End CosSin.


Section Daumas.

(* The precision *)
Let prec := 52%bigZ.

Definition daumas := 
  atan(x) - 
    ('x - c(11184811,33554432) * 'x ^ 3 -
          c(13421773,67108864) * 'x ^ 5).

Let k := 25%Z.

Lemma daumas_correct x :
 (((- 1) / 30)  <= x <= (1 / 30) ->
  (IZR (-1) / IZR (2 ^ k)) <= 
     (atan x - (x - 11184811/33554432 * x ^ 3 
                                    - 13421773/67108864 * x ^ 5))
   <= (IZR (1) / IZR (2 ^ k)))%R.
Proof.
move=> H.
cheby_solve_tac prec 1%nat 3%nat daumas H.
Time Qed.

End Daumas.

Section Florent. (* ITP 2019 *)

Let prec := 52%bigZ.

Definition florent :=  sqrt(2 + 'x ^2).
Time Definition florent_cms :=
  Eval native_compute in mk_cms prec 200 (-1)%Z 1%Z florent.

Compute P florent_cms.
Compute Delta florent_cms.
(* Not so good *)
Compute Delta (norm_cms prec florent_cms).
Compute P (norm_cms prec florent_cms).

Lemma florent_correct : cms_correct 200 (-1)%Z 1%Z 
           (fun x => sqrt (2 + x ^ 2))%R florent_cms.
Proof.
rewrite (_ : florent_cms = mk_cms prec 200 (-1)%Z 1%Z florent); last first.
  by vm_cast_no_check (refl_equal florent_cms).
have-> : (fun x => sqrt (2 + x ^ 2))%R = (fexpr_eval florent).
  by apply: refl_equal.
by apply mk_cms_correct.
Time Qed.

Definition f1 eps x := sqrt (eps^2 + x^2).

(* Proved by bisection *)
Lemma florent_test0 x :
  let eps := (1/1000)%R in
  (-1 <= x <= 1)%R ->
  (Rabs (f1 eps x - Rabs x) <= eps + 1 / 10000)%R.
Proof.
intros eps H; subst eps; unfold f1.
suff : ((0/1 <= x <= 1/1)%R ->
              ((-11 / 10000) <=  (sqrt ((1 / 1000) ^ 2 + x ^ 2) - x) <=
               (11 / 10000))%R) 
          /\
          (((-1)/1 <= x <= 0/1)%R ->
             ((- 11) / 10000 <=  (sqrt ((1 / 1000) ^ 2 + x ^ 2) + x) <=
             (11 / 10000))%R).
    by split_Rabs; lra.
split => H1.
  set florent := sqrt(c(1,1000) ^ 2 + 'x ^ 2) - 'x.
  cheby_solve_tac prec 10%nat 5%nat florent H1.
set florent := sqrt(c(1,1000) ^ 2 + 'x ^ 2) + 'x.
cheby_solve_tac prec 10%nat 5%nat florent H1.
Time Qed.

End Florent.

